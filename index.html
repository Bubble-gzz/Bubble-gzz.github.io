<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Bubble&#39;s bubble">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Bubble&#39;s bubble">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Bubble">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"hide","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://example.com/"/>





  <title>Bubble's bubble</title>
  








<meta name="generator" content="Hexo 6.0.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Bubble's bubble</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"><oOoOoOoOoOo</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/07/25/Unity%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2025/07/25/Unity%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" itemprop="url">Unity异步编程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2025-07-25T19:21:17+08:00">
                2025-07-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index">
                    <span itemprop="name">unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="代码A1"><a href="#代码A1" class="headerlink" title="代码A1"></a>代码A1</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Playground Start&quot;</span>);</span><br><span class="line">        HeavyTask();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Playground End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">HeavyTask</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;HeavyTask Start&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</span><br><span class="line">        Debug.Log(<span class="string">&quot;HeavyTask End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出结果:</span></span><br><span class="line"><span class="comment">Playground Start</span></span><br><span class="line"><span class="comment">HeavyTask Start</span></span><br><span class="line"><span class="comment">Playground End</span></span><br><span class="line"><span class="comment">HeavyTask End</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码A2"><a href="#代码A2" class="headerlink" title="代码A2"></a>代码A2</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;Playground Start&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> HeavyTask();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Playground End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">HeavyTask</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;HeavyTask Start&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</span><br><span class="line">        Debug.Log(<span class="string">&quot;HeavyTask End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">输出结果:</span></span><br><span class="line"><span class="comment">Playground Start</span></span><br><span class="line"><span class="comment">HeavyTask Start</span></span><br><span class="line"><span class="comment">HeavyTask End</span></span><br><span class="line"><span class="comment">Playground End</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码B1"><a href="#代码B1" class="headerlink" title="代码B1"></a>代码B1</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">LoadAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> n = <span class="number">100000000</span>;</span><br><span class="line">        <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            UniTask.Post(</span><br><span class="line">                () =&gt; progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        Debug.Log(<span class="string">&quot;LoadAnimation End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行效果：</span></span><br><span class="line"><span class="comment">LoadAnimation End</span></span><br><span class="line"><span class="comment">Start End</span></span><br><span class="line"><span class="comment">游戏画面卡住，随后进度条一下子变成100%，画面恢复流畅</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码B2"><a href="#代码B2" class="headerlink" title="代码B2"></a>代码B2</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">LoadAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> n = <span class="number">100000000</span>;</span><br><span class="line">        <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            UniTask.Post(</span><br><span class="line">                () =&gt; progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i)</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">        Debug.Log(<span class="string">&quot;LoadAnimation End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    效果和B1一样</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码C1"><a href="#代码C1" class="headerlink" title="代码C1"></a>代码C1</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">LoadAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Task.Run(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">                <span class="built_in">int</span> n = <span class="number">100000000</span>;</span><br><span class="line">                <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    UniTask.Post(</span><br><span class="line">                        () =&gt; progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i)</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        Debug.Log(<span class="string">&quot;LoadAnimation End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行效果：</span></span><br><span class="line"><span class="comment">LoadAnimation End</span></span><br><span class="line"><span class="comment">Start End</span></span><br><span class="line"><span class="comment">游戏画面十分卡顿，但进度条能看出每次都在刷新，进度条变成100%后恢复流畅</span></span><br><span class="line"><span class="comment">卡顿原因：UniTask.Post过于频繁，导致主线程的消息队列爆炸</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码C2"><a href="#代码C2" class="headerlink" title="代码C2"></a>代码C2</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">LoadAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> Task.Run(</span><br><span class="line">            () =&gt; &#123;</span><br><span class="line">                <span class="built_in">int</span> n = <span class="number">100000000</span>;</span><br><span class="line">                <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    UniTask.Post(</span><br><span class="line">                        () =&gt; progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i)</span><br><span class="line">                    );</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        Debug.Log(<span class="string">&quot;LoadAnimation End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行效果：</span></span><br><span class="line"><span class="comment">Start End</span></span><br><span class="line"><span class="comment">游戏画面十分卡顿，但进度条能看出每次都在刷新，进度条变成100%后恢复流畅</span></span><br><span class="line"><span class="comment">最后输出LoadAnimation End</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码D1"><a href="#代码D1" class="headerlink" title="代码D1"></a>代码D1</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> PlayAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">PlayAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;PlayAnimation A End&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;PlayAnimation B End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">LoadAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> Task.Run(</span><br><span class="line">            <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="built_in">int</span> n = <span class="number">100</span>;</span><br><span class="line">                <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    UniTask.Post(</span><br><span class="line">                        () =&gt; progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i)</span><br><span class="line">                    );</span><br><span class="line">                    <span class="keyword">await</span> Task.Delay(<span class="number">100</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行效果：</span></span><br><span class="line"><span class="comment">画面流畅，进度条缓慢增长</span></span><br><span class="line"><span class="comment">加载完第一根：PlayAnimation A End</span></span><br><span class="line"><span class="comment">加载完第二根：PlayAnimation B End</span></span><br><span class="line"><span class="comment">Start End</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码D2"><a href="#代码D2" class="headerlink" title="代码D2"></a>代码D2</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Transform triangle;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        triangle.Rotate(<span class="number">0</span>, <span class="number">0</span>, Time.deltaTime * <span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> PlayAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">PlayAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;PlayAnimation A End&quot;</span>);</span><br><span class="line">        <span class="keyword">await</span> LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;PlayAnimation B End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Task <span class="title">LoadAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Task.Run(</span><br><span class="line">            <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">                <span class="built_in">int</span> n = <span class="number">100</span>;</span><br><span class="line">                <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    UniTask.Post(</span><br><span class="line">                        () =&gt; progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i)</span><br><span class="line">                    );</span><br><span class="line">                    <span class="keyword">await</span> Task.Delay(<span class="number">100</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">运行效果同D1，注意对比async Task和不带async的Task</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码E"><a href="#代码E" class="headerlink" title="代码E"></a>代码E</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> PlayAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">PlayAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;PlayAnimation A End&quot;</span>);</span><br><span class="line">        triangle.position = <span class="keyword">new</span> Vector3(<span class="number">5</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">await</span> LoadAnimation();</span><br><span class="line">        Debug.Log(<span class="string">&quot;PlayAnimation B End&quot;</span>);</span><br><span class="line">        triangle.position = <span class="keyword">new</span> Vector3(<span class="number">0</span>, <span class="number">-5</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">LoadAnimation</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> n = <span class="number">1000</span>;</span><br><span class="line">        <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i);</span><br><span class="line">            <span class="keyword">await</span> Task.Yield();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行效果：</span></span><br><span class="line"><span class="comment">画面流畅，进度条流畅加载</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h3 id="代码F"><a href="#代码F" class="headerlink" title="代码F"></a>代码F</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> Image progressBar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        HeavyTask();</span><br><span class="line">        Debug.Log(<span class="string">&quot;Start End&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">async</span> Task <span class="title">HeavyTask</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">await</span> Task.Delay(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> t = <span class="number">0</span>; t &lt; <span class="number">1000</span>; t++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">int</span> n = <span class="number">10000000</span>;</span><br><span class="line">            <span class="built_in">double</span> iUnit = <span class="number">1f</span>/n;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                progressBar.fillAmount = (<span class="built_in">float</span>)(iUnit * i);</span><br><span class="line">            &#125;</span><br><span class="line">            Debug.Log(<span class="string">&quot;[&quot;</span> + Thread.CurrentThread.ManagedThreadId + <span class="string">&quot;] HeavyTask &quot;</span> + t);</span><br><span class="line">            <span class="keyword">await</span> Task.Delay(<span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行效果：</span></span><br><span class="line"><span class="comment">每过一秒钟画面就会卡一下，输出表明HeavyTask在主线程运行</span></span><br><span class="line"><span class="comment">这说明这里在await之后的代码仍然会用主线程执行</span></span><br><span class="line"><span class="comment">要想不占用，应该放到task.run里面专门用一个子线程来执行</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h2 id="关键点"><a href="#关键点" class="headerlink" title="关键点"></a>关键点</h2><p>1.想要一个方法能够被等待，类型设成Task</p>
<p>2.想要一个方法能够等待别的方法，加上关键词async</p>
<p>3.async关键字 Task类型的方法 不需要写返回值，底层会被自动处理</p>
<p>4.async并不是直接异步，而是遇到await发现task没执行完才会挂起，其余部分代码仍然会被线程一口气同步执行完。切记不要把计算密集型任务放在主线程会执行的代码块中。</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014361280/article/details/132421056">以下摘自博客</a><br>Task 看起来像一个Thread，实际上，它是在ThreadPool的基础上进行的封装，Task的控制和扩展性很强，在线程的延续、阻塞、取消、超时等方面远胜于Thread和ThreadPool。</p>
<p>async 和 await ，await 运算符暂停对其所属的 async 方法的求值，直到其操作数表示的异步操作完成。 异步操作完成后，await 运算符将返回操作的结果（如果有）。 当 await 运算符应用到表示已完成操作的操作数时，它将立即返回操作的结果，而不会暂停其所属的方法。 await 运算符不会阻止计算异步方法的线程。 当 await 运算符暂停其所属的异步方法时，控件将返回到方法的调用方。</p>
<p>5.await恢复继续执行后的线程和await前未必一致，而是根据有没有上下文恢复等情况决定，如果没有恢复那就可能由别的线程来执行。</p>
<p>这一点注意，因为unity api必须在主线程调用，否则会出错。</p>
<p>虽然unity会默认回到主线程，但还是请注意，比如有没有显示切换到别的线程还访问了unity api。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/04/14/lambda%E5%87%BD%E6%95%B0%E4%B8%8E%E9%97%AD%E5%8C%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2025/04/14/lambda%E5%87%BD%E6%95%B0%E4%B8%8E%E9%97%AD%E5%8C%85/" itemprop="url">lambda函数与闭包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2025-04-14T10:28:06+08:00">
                2025-04-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C#</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>我想生成20个小方块，编号<code>id</code>为0~19，点击后依次调用函数<code>f(id)</code>，如何简洁实现？</p>
<h3 id="方案A"><a href="#方案A" class="headerlink" title="方案A"></a>方案A</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">    callback[i] = () =&gt; f(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不可行,最后调用的都是<code>f(20)</code>，因为每一个闭包保存的都是同一个循环变量<code>i</code>，<code>i</code>的最终值是<code>20</code>。</p>
<h3 id="方案B"><a href="#方案B" class="headerlink" title="方案B"></a>方案B</h3><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">    <span class="built_in">int</span> capturedValue = i;</span><br><span class="line">    callback[i] = () =&gt; f(capturedValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可行，依次调用<code>f(0)</code> ~ <code>f(19)</code>。因为capturedValue的作用域仅限单次循环内，每次循环都会重新生成，所以每个闭包保存的是不同的变量。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/03/13/%E6%9C%9F%E6%9C%9B%E6%82%96%E8%AE%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2024/03/13/%E6%9C%9F%E6%9C%9B%E6%82%96%E8%AE%BA/" itemprop="url">期望“悖论”</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2024-03-13T15:24:03+08:00">
                2024-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/bubble/" itemprop="url" rel="index">
                    <span itemprop="name">bubble</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>有两个信封，分别装着c元钱、2c元钱。<br>现在随机将两个信封分发给两个玩家，并告知他们其中某个信封中的钱是另一个信封中的两倍。<br>他们只能看到自己拿到的信封内的金额，所以并不知道自己拿到的那份钱更多还是对方拿到的钱更多。<br>但他们可以选择是否提出交换信封的请求，当双方都提出交换请求时，交换成立。<br>他们的目标是使自己最后手中持有的金额数最大，他们应该采取什么策略比较好？</p>
</blockquote>
<p>bub同学认为交换的话，如果亏了，那只亏了一半；而如果赚了，将赚一倍。因为亏和赚的概率对等，所以交换更划算。更加形式化地描述一下策略，就是：</p>
<blockquote>
<p>假如我是其中一名玩家，我手中的金额是$x$，那么交换信封后，会等概率地发生两个随机事件中的一个：<br>事件A：x是较小的那笔钱，我获得手中金额的双倍，$2x$元，也就是获得$x$元收益；<br>事件B：x是较大的那笔钱，我获得手中金额的一半，$0.5x$元，也就是获得$-0.5x$元收益。<br>交换信封的期望收益 $E(Gain) &#x3D; 0.5(2x-x)+0.5(0.5x-x) &#x3D; 0.5x-0.25x &#x3D; 0.25x &gt; 0$<br><strong>所以选择交换对我来说更有利。</strong></p>
</blockquote>
<p>似乎挺有道理的，但有一个疑点：这本来是一个零和博弈，双方的总收益应该始终为0，那么双方期望收益的和也应该是0，而bub的计算结果却表明双方的期望收益都大于0。哪儿出错了？</p>
<p><strong>这里实际上隐含了一个很神奇的错误</strong></p>
<p>提问：有一个主持人会决定是否向一个箱子里放一只兔子。<br>现在你打开箱子，如果有兔子，你获得10000元奖金，如果没有兔子，你被罚10000元。<br>问你打开箱子的期望收益？</p>
<p>提问：有一个主持人有30%的概率向一个箱子里放一只兔子，并且已经完成了她的这项随机操作。<br>现在你打开箱子，如果有兔子，你获得10000元奖金，如果没有兔子，你被罚10000元。<br>问你打开箱子的期望收益？</p>
<p>主持人有30%的概率选择10元和5元，有70%的概率选择10元和20元。<br>关键在于你是否知情真的会影响一件事情的概率吗？<br>实际上如果信封里面是10元和5元，那么你拿到10元，它是最大面值的概率是100%。<br>可是你只知道主持人有30%的概率选择10元和5元，所以你认为概率是30%。<br>到底哪个概率是对的呢？</p>
<p>关键在于P(你手中金额是较小金额的概率)≠P(你发现手中金额是10元，它是较小金额的概率)<br>虽然当你发现金额是10元时，理论上它既可能是较小金额也可能是较大金额，可是这个结果不管进行多少局游戏，它都是不变的。<br>这是因为游戏设定本身其实只生成了一次，在这个固定的游戏设定下，10元的身份就已经固定了，不再具有随机性。<br>在你看来具有随机性是因为你不确定，你认为哪种都有可能，你的这个估计其实是一种假设，而不会在实际统计中出现。<br>这不禁让人想，概率到底是什么。不确定的事情，概率可能是100%？？<br>你不确定不代表这个事情真的不确定。你不确定只是因为你没有掌握全部的信息。</p>
<p>那就是直觉上，x有50%的概率是更大的面值，有50%的概率是更小的面值；<br>而实际上，手中的x是一个确定的金额，在这场游戏中，它要么是更大的面值，要么是更小的面值，并不存在随机的结果。<br>你只能说，在你没有打开信封前，你手中的金额有50%的概率是更大的面值，有50%的概率是更小的面值；<br>而在你打开信封确认了金额后，你手中的金额的概念其实从一个随机变量变成了一个确定的值x，x只可能100%是较大数或者100%是较小数，只是你无从得知。</p>
<p>bub认为的五五开，其实已经将游戏的模型改成了这样：<br>每当你打开信封时，另一个信封的钱都有50%的概率变成你手中的一半，也有50%概率变成你手中的两倍。<br>这种模型下的期望并不符合原来的模型。</p>
<p>正是因为<br>也就是说事件A和事件B中有一个事件的概率是0，另一个事件的概率是1，并不是五五开！<br>游戏每一局都会随机刷新信封中的钱数，而你此时拿到的钱数为x，x应该有50%的概率是较小值，有50%的概率是较大值。<br>在那些你拿到的钱数为x的局内，可能的信封组合为（x，2x）、（0.5x，x）。<br>可是实际上游戏不管进行多少局，信封组合都是固定不变的。</p>
<p><a target="_blank" rel="noopener" href="https://www.zhihu.com/question/46805128">https://www.zhihu.com/question/46805128</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv32725271/">https://www.bilibili.com/read/cv32725271/</a></p>
<p>你只能在还没有打开信封之前说你手中的金额有50%的概率是更大的面值，有50%的概率是更小的面值，<br>而一旦打开信封确认了金额，你手中的金额要么100%的概率是更大的面值，要么100%的概率是更小的面值，<br>因为此时你手中的金额是大还是小已经附带了一个前提条件，那就是它的金额是x。<br>在这个条件概率分布下，金额只能是大或者小中的一种了。</p>
<p>你认为的随机是建立在游戏本身也随机生成信封，每次游戏信封的钱都在变化的基础上的。<br>可事实是<br>举个例子，一个信封里面是5元，另一个信封里面是10元，那么不管玩多少次，5元永远是更小的那个，而不是“50%是更小的，50%是更大的”。<br>可是，从玩家的视角来看，他拥有的信息不足以看出x更倾向于是更大的面值还是更小的面值，他只能认为有50%的概率是更大的，有50%的概率是更小的。</p>
<p>当你拿到的信封是10元时，它都是较大的那份，而不可能“50%的概率是较大的那份，50%的概率是较小的那份”。<br>这里需要区别于另一个说法：你手中的金额50%的概率是较大的那份，50%的概率是较小的那份。<br>这个说法是没问题的，因为这个说法中，“手中的金额”是一个还没有确定结果的随机变量，它可以指代不同的金额。<br>而bub的分析中，x是一个已经确定的量，那么接下来和x有关的事件实际上都是以“金额为x”作为前提条件的条件概率事件，</p>
<p>当手中金额是较大值时，概率分布为：P(事件1)&#x3D;0%，P(事件2)&#x3D;100%；<br>当手中金额是较小值是，概率分布为：P(事件1)&#x3D;100%，P(事件2)&#x3D;0%。<br>在任何一种情况下，概率分布都不是bub所认为的等概率分布。</p>
<p>不妨对比一下另一位同学ble给出的分析：</p>
<blockquote>
<p>假如我是其中一名玩家，那么那么交换信封后，会等概率地发生两个随机事件中的一个：<br>事件A：我手中是较小的那笔钱$c$，我获得手中金额的双倍，也就是$2c$元，净收益$c$元；<br>事件B：我手中是较大的那笔钱$2c$，我获得手中金额的一半，也就是$2c$元，交换后获得$c$元，净收益$-c$元。<br>所以期望收益 $E(Gain) &#x3D; 0.5c + 0.5(-c) &#x3D; 0$<br>如果交换不成功，那么显然收益为0.<br>因此不管是否交换，我的期望收益都是0，<br><strong>交不交换是无所谓的。</strong></p>
</blockquote>
<p>发现区别了吗？<br>没错，bub同学定义的两个随机事件中，“手中的金额”始终等于自己信封里实际装着的x元钱。<br>而实际上这两个事件中提到的“手中的金额”应该像ble同学分析中那样分别指代不同的金额c和2c。</p>
<p>不妨让事情更明显，我们将x替换成具体的数字5，也就是一名玩家拿到的金额是5元。那么bub同学的思路就变成：</p>
<blockquote>
<p>假如我是其中一名玩家，我手中的金额是5，那么交换信封后，会等概率地发生两个随机事件中的一个：<br>事件A：5元是较小的那一笔钱，我获得手中金额的双倍，10元，也就是获得5元收益；<br>事件B：5元是较大的那一笔钱，我获得手中金额的一半，2.5元，也就是获得-2.5元收益。</p>
</blockquote>
<p>这时候错误就更明显了，因为在一个确定的游戏中，不管进行多少次，5元要么是较大的那一笔钱，要么是较小的那一笔钱，而不可能有时是较大的那笔钱，有时是较小的那笔钱。</p>
<p>的确，玩家手中的钱既可能是较小的那一笔，也有可能是较大的那一笔，但如果说5元既可能是较小的那一笔，也有可能是较大的那一笔，那就很扯了。<br>不能因为现在5元碰巧在玩家手里，就将“玩家手中的钱”和“5元”这两个概念划等号。<br>实际上由于bub已经假定自己手中的金额是x，这个时候“玩家手中的钱”也就从一个随机变量变成了一个确定值，这个局面下求的概率已经是条件概率，<br>要么100%发生事件A，要么100%发生事件B，至于是哪一个，由于玩家不知道c是多少，所以也无从得知。所以bub实际上想求条件概率却没能成功，<br>求了一个四不像。</p>
<p>这让我想起小时候看到的一个很经典的偷换概念的说法：</p>
<blockquote>
<p>$1元&#x3D;10角，1元\times1元&#x3D;10角\times10角&#x3D;100角&#x3D;10元$</p>
</blockquote>
<p>我们都知道1元不可能等于10元，那这种说法哪里有问题呢？</p>
<p>单位本身就有着数量上的意义，<strong>元</strong>这个单位本身就代表<strong>角</strong>这个单位的10倍，所以你不应该无视单位去做运算，如果真要运算，也应该是</p>
<blockquote>
<p>$1元\times1元&#x3D;10角\times10角&#x3D;100角^2&#x3D;100(\frac{1}{10}元)^2&#x3D;1元^2$</p>
</blockquote>
<p>没有任何矛盾，更不用说这种货币单位相乘的运算本身也没有什么实际意义。</p>
<p>这让我不禁想到世界上很多的矛盾和争吵最终都毫无意义，因为双方根本就不在一个语境下讨论问题，概念都没有统一，还有什么继续讨论的必要呢。概念的定义是非常重要的，就像支配世界的物理法则一样，物理法则有任何漏洞，世界也将崩溃。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/13/Constructor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2023/09/13/Constructor/" itemprop="url">Constructor</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2023-09-13T18:52:08+08:00">
                2023-09-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Object-Oriented-Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Object-Oriented Programming</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记录一下关于类的构造函数以及初始化相关的东西。<br>有两大问题，其中一个是隐式默认函数，另一个是构造函数的继承。<br>隐式默认函数是指在用户没有显式定义构造函数的时候编译器自动隐式定义的默认构造函数，由于这是默认添加的，<br>如果没有搞清楚背后的行为很容易造成初始化遗漏的问题。<br>另一个问题是构造函数的继承，当一个子类继承自父类时，继承了属性和方法，但是继承函数呢？继承函数又可能很多，分为默认的和非默认的，<br>这个时候继承的内容似乎又变得更加混乱了。<br>目前似乎没有语言是默认子类继承父类的构造函数的，而是需要显式地定义子类的构造函数或是从父类继承。<br>鉴于这两个问题的复杂和琐碎，各个语言的处理方式不尽相同，所以作一个整理记录。</p>
<h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><p>首先有一个各类语言都差不多的逻辑，那就是属性直接赋值是先于构造函数发生的，以java为例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">1</span>, b = <span class="number">2</span>;</span><br><span class="line">    Arr()&#123;a=<span class="number">2</span>;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最终a的值会变成2。</p>
<h2 id="C"><a href="#C" class="headerlink" title="C++"></a>C++</h2><h3 id="花括号初始化"><a href="#花括号初始化" class="headerlink" title="花括号初始化"></a>花括号初始化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">arr</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr A = arr&#123;&#125;;              <span class="comment">// ok</span></span><br><span class="line">    arr B = arr&#123;<span class="number">1</span>&#125;;             <span class="comment">// ok</span></span><br><span class="line">    arr C = arr&#123;<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>&#125;;    <span class="comment">// ok</span></span><br><span class="line">    arr D = arr&#123;<span class="string">&quot;hello&quot;</span>, <span class="number">1</span>&#125;;    <span class="comment">// compile error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当没有定义constructor时，用花括号的内容可以对号入座地进行初始化。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">arr</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">    <span class="built_in">arr</span>(<span class="type">int</span> _a, string _b):a&#123;_a&#125;,b&#123;_b&#125;&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr A = arr&#123;&#125;;              <span class="comment">// compile error</span></span><br><span class="line">    arr B = arr&#123;<span class="number">1</span>&#125;;             <span class="comment">// compile error</span></span><br><span class="line">    arr C = arr&#123;<span class="number">1</span>, <span class="string">&quot;hello&quot;</span>&#125;;    <span class="comment">// ok</span></span><br><span class="line">    arr D = arr&#123;<span class="string">&quot;hello&quot;</span>, <span class="number">1</span>&#125;;    <span class="comment">// compile error</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当定义了constructor时，不再执行默认的对号入座初始化，而是调用对应参数格式的constructor<br>没有参数时也是同样的道理：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">arr</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">    <span class="built_in">arr</span>()&#123; a = <span class="number">5</span>; b = <span class="string">&quot;hello&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr A = arr&#123;&#125;;</span><br><span class="line">    cout &lt;&lt; A.a &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; A.b; <span class="comment">//5 hello</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意花括号初始化隐藏了一个默认值的规则，也就是当填写的参数少于实际需要的参数时，后面的参数默认为0或是其它对应的默认初始值。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr A&#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">    cout&lt;&lt;A.a&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;A.b&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;A.c&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;endl; <span class="comment">// 1 2 0</span></span><br><span class="line">    <span class="type">int</span> list[<span class="number">5</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) cout&lt;&lt;list[i]&lt;&lt;<span class="string">&quot; &quot;</span>; <span class="comment">// 1 2 0 0 0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="初始化以及创建临时实例"><a href="#初始化以及创建临时实例" class="headerlink" title="初始化以及创建临时实例"></a>初始化以及创建临时实例</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">arr</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">    <span class="built_in">arr</span>(<span class="type">int</span> _a, string _b): a&#123;_a&#125;, <span class="built_in">b</span>(_b) &#123; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(arr A)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; A.a &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; A.b &lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr A = &#123;<span class="number">5</span>, <span class="string">&quot;hello&quot;</span>&#125;;</span><br><span class="line">    arr B&#123;<span class="number">5</span>, <span class="string">&quot;hello&quot;</span>&#125;;</span><br><span class="line">    arr C = <span class="built_in">arr</span>(<span class="number">5</span>, <span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    <span class="built_in">foo</span>(A);</span><br><span class="line">    <span class="built_in">foo</span>(B);</span><br><span class="line">    <span class="built_in">foo</span>(C);</span><br><span class="line">    <span class="built_in">foo</span>(<span class="built_in">arr</span>(<span class="number">5</span>, <span class="string">&quot;hello&quot;</span>));</span><br><span class="line">    <span class="built_in">foo</span>(arr&#123;<span class="number">5</span>, <span class="string">&quot;hello&quot;</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment">Output:</span></span><br><span class="line"><span class="comment">5 hello</span></span><br><span class="line"><span class="comment">5 hello</span></span><br><span class="line"><span class="comment">5 hello</span></span><br><span class="line"><span class="comment">5 hello</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>可以看到不同的创建临时实例的方式，实际上都是调用了对应参数的constructor。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> a,b,c;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(arr A)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;A.a&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;A.b&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;A.c&lt;&lt;endl;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">foo</span>(&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;);</span><br><span class="line">    <span class="built_in">foo</span>(arr&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>给没有显式构造函数的类型传递参数时，对号入座法也适用。</p>
<h3 id="default-constructor"><a href="#default-constructor" class="headerlink" title="default constructor"></a>default constructor</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">arr</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr A;</span><br><span class="line">    cout&lt;&lt;A.a&lt;&lt;endl;</span><br><span class="line">    arr B&#123;&#125;;</span><br><span class="line">    cout&lt;&lt;B.a&lt;&lt;endl;</span><br><span class="line">    arr C = <span class="built_in">arr</span>();</span><br><span class="line">    cout&lt;&lt;C.a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output:</span></span><br><span class="line"><span class="comment">112197632</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">arr</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">    <span class="built_in">arr</span>()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    arr A;</span><br><span class="line">    cout&lt;&lt;A.a&lt;&lt;endl;</span><br><span class="line">    arr B = <span class="built_in">arr</span>();</span><br><span class="line">    cout&lt;&lt;B.a&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output:</span></span><br><span class="line"><span class="comment">-38797312</span></span><br><span class="line"><span class="comment">-421528752</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>可以看到不显式地进行初始化导致初始值不干净的问题。查阅资料可知，当没有显式定义constructor的时候，<br>编译器会隐式地定义一个默认的constructor，但这个constructor到底会不会贴心地给属性初始化为默认值，我不好说。<br>所以有两种方法可以确保属性被正确地初始化为默认值：<br>（1）不定义任何constructor，然后用空{}的形式进行对号入座式的初始化<br>（2）显式定义一个不带参数的default constructor，然后在里面手动初始化，实例化的时候可以采用下面几种写法：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arr A; <span class="comment">//默认调用default constructor</span></span><br><span class="line">arr A=<span class="built_in">arr</span>(); <span class="comment">//显式调用default constructor</span></span><br><span class="line">arr A&#123;&#125;; <span class="comment">//显式调用default constructor</span></span><br><span class="line">arr A = &#123;&#125;; <span class="comment">//显式调用default constructor</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">    <span class="built_in">arr</span>(<span class="type">int</span> _a, string _b):a&#123;_a&#125;,b&#123;_b&#125;&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">arr <span class="title">A</span><span class="params">(<span class="number">5</span>, <span class="string">&quot;hello&quot;</span>)</span></span>;</span><br><span class="line">    cout&lt;&lt;A.a&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;A.b&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以使用<code>arr A(5, &quot;hello&quot;)</code>代替<code>arr A = arr(5, &quot;hello&quot;)</code>。但是看下面这种情况</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> a;</span><br><span class="line">    string b;</span><br><span class="line">    <span class="built_in">arr</span>()&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">arr <span class="title">A</span><span class="params">()</span></span>;</span><br><span class="line">    cout&lt;&lt;A.a&lt;&lt;<span class="string">&quot; &quot;</span>&lt;&lt;A.b&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>却会编译错误，提示A是一个函数。这里是声明了一个没有参数的，返回值为arr的函数A。这也被称为”the most vexing parse”之一。</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><p>下面是最头疼的继承。c++的继承还没有研究，先不说。</p>
<h2 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h2><h3 id="默认构造函数"><a href="#默认构造函数" class="headerlink" title="默认构造函数"></a>默认构造函数</h3><p>Java如果没有显示定义构造函数，那么会有一个空的默认构造函数。如果用户定义了至少一个构造函数，那么编译器就不会再自动定义空的默认构造函数，这时如果<br>用户希望使用 new A()这种无参数的构造函数，就需要自己手动定义。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> <span class="number">0</span>, b = <span class="number">0</span>;</span><br><span class="line">    Arr()&#123;&#125; <span class="comment">//必须要！ 如果去掉，那么*处就会报错，找不到对应格式的构造函数</span></span><br><span class="line">    Arr(<span class="type">int</span> _a, <span class="type">int</span> _b)&#123;</span><br><span class="line">        a=_a; b= _b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">        <span class="type">Arr</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Arr</span>(); <span class="comment">// * </span></span><br><span class="line">        System.out.println(temp.a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="构造函数的继承"><a href="#构造函数的继承" class="headerlink" title="构造函数的继承"></a>构造函数的继承</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b;</span><br><span class="line">    Arr()&#123;a=<span class="number">5</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Brr</span> <span class="keyword">extends</span> <span class="title class_">Arr</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">        <span class="type">Arr</span> <span class="variable">temp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Arr</span>();</span><br><span class="line">        <span class="type">Brr</span> <span class="variable">temp2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Brr</span>();</span><br><span class="line">        System.out.println(temp.a + <span class="string">&quot; &quot;</span> + temp2.a); <span class="comment">//5 5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，Brr默认继承了Arr的构造函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Arr</span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b;</span><br><span class="line">    Arr(<span class="type">int</span> _a)&#123;a=_a;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Brr</span> <span class="keyword">extends</span> <span class="title class_">Arr</span> &#123; <span class="comment">//error:There is no default constructor in Arr</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>可以看到这个时候编译器报错。<br>子类必须显式地在构造函数中调用父类的某个构造函数super(…)，如果没有，那么会默认调用父类的default constructor。<br>第一个例子之所以没有报错是因为父类有default constructor。</p>
<p>其中设计者的逻辑可能是，子类的初始化至少应该符合父类的某种初始化形式，而不是完全脱离父类的初始化?<br>既然子类可以override父类的方法，为什么不能override父类的构造函数呢？<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14250486/why-exactly-do-subclass-constructors-have-to-explicitly-call-super-class-constru#:~:text=This%20is%20required%20because%20the,parameters%20need%20to%20be%20passed">这个链接说的不错</a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Java中，构造函数不会默认继承，子类在继承父类的时候，每一个构造函数都应当显式地在开头调用父类的某个构造函数。</p>
<h2 id="Kotlin"><a href="#Kotlin" class="headerlink" title="Kotlin"></a>Kotlin</h2><h3 id="Instantiation"><a href="#Instantiation" class="headerlink" title="Instantiation"></a>Instantiation</h3><p>Kotlin不用new关键字，直接调用构造函数：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> bob = Student(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="Constructor"><a href="#Constructor" class="headerlink" title="Constructor"></a>Constructor</h3><p>Kotlin的构造函数比较独特，一个类可以拥有一个primary constructor和若干个secondary constructor，<br>primary constructor用于声明属性和完成必备的初始化，secondary constructor用于额外的初始化，<br>secondary constructor必须显式地调用primary constructor。</p>
<h4 id="Primary-Constructor"><a href="#Primary-Constructor" class="headerlink" title="Primary Constructor"></a>Primary Constructor</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(<span class="keyword">val</span> age:<span class="built_in">Int</span>, <span class="keyword">var</span> grade:<span class="built_in">Int</span>, param:<span class="built_in">Int</span>) <span class="comment">//manner A</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">constructor</span></span>(<span class="keyword">val</span> age:<span class="built_in">Int</span>, <span class="keyword">var</span> grade:<span class="built_in">Int</span>, param:<span class="built_in">Int</span>) <span class="comment">//manner B</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">constructor</span></span>(<span class="keyword">val</span> age:<span class="built_in">Int</span>, <span class="keyword">var</span> grade:<span class="built_in">Int</span>, param:<span class="built_in">Int</span>)&#123;&#125; <span class="comment">//manner C</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在主体部分没有代码的情况下，可以省略花括号，写法C简化成写法B，<br>在没有额外的修饰词的情况下，写法B又可以简写成写法A。<br>出现在参数列表中以val或者var修饰的参数都会默认成为property，否则只是一个用于初始化的临时参数。<br>primary constructor的初始化代码被放在Initializer Block中。<br>代码按照从上到下的顺序依次执行遇到的property initializer和initializer block。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InitOrderDemo</span></span>(name: String) &#123;</span><br><span class="line">    <span class="keyword">val</span> firstProperty = <span class="string">&quot;First property: <span class="variable">$name</span>&quot;</span>.also(::println)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;First initializer block that prints <span class="variable">$name</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">val</span> secondProperty = <span class="string">&quot;Second property: <span class="subst">$&#123;name.length&#125;</span>&quot;</span>.also(::println)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Second initializer block that prints <span class="subst">$&#123;name.length&#125;</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output:</span></span><br><span class="line"><span class="comment">First property: hello</span></span><br><span class="line"><span class="comment">First initializer block that prints hello</span></span><br><span class="line"><span class="comment">Second property: 5</span></span><br><span class="line"><span class="comment">Second initializer block that prints 5</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>可以啥也不写，会有一个默认的空的构造函数:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dumb</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value:<span class="built_in">Int</span> = <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> dumb = Dumb()</span><br><span class="line">    println(<span class="string">&quot;dumb.value: <span class="subst">$&#123;dumb.value&#125;</span>&quot;</span>) <span class="comment">// dumb.value: 5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Secondary-Constructor"><a href="#Secondary-Constructor" class="headerlink" title="Secondary Constructor"></a>Secondary Constructor</h4><p>二级构造函数的执行发生在主构造函数部分（包括initializer block和property initializer）之后。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Constructors</span> </span>&#123;</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Init block A&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(i: <span class="built_in">Int</span>) &#123;</span><br><span class="line">        println(<span class="string">&quot;Constructor <span class="variable">$value</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> value:<span class="built_in">Int</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        println(<span class="string">&quot;Init block B&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output:</span></span><br><span class="line"><span class="comment">Init block A</span></span><br><span class="line"><span class="comment">Init block B</span></span><br><span class="line"><span class="comment">Constructor 4</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>二级构造函数必须直接或间接调用一级构造函数（如果有的话）。<br>二级构造函数的参数不允许使用val或者var修饰，只用于传参目的。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>(<span class="keyword">var</span> age:<span class="built_in">Int</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> grade:<span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> height:<span class="built_in">Int</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">init</span> &#123; println(<span class="string">&quot;constructor A    age: <span class="variable">$age</span>&quot;</span>) &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(age:<span class="built_in">Int</span>, grade:<span class="built_in">Int</span>):<span class="keyword">this</span>(age)</span><br><span class="line">    &#123;</span><br><span class="line">        println(<span class="string">&quot;constructor B1&quot;</span>)</span><br><span class="line">        <span class="keyword">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(age:<span class="built_in">Int</span>, grade:<span class="built_in">Int</span>, height:<span class="built_in">Int</span>):<span class="keyword">this</span>(age, grade)</span><br><span class="line">    &#123;</span><br><span class="line">        println(<span class="string">&quot;constructor B2&quot;</span>)</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> bob = Student(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output:</span></span><br><span class="line"><span class="comment">constructor A    age: 1</span></span><br><span class="line"><span class="comment">constructor B1</span></span><br><span class="line"><span class="comment">constructor B2</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>没有定义主构造函数，那么二级构造函数就可以没有交集了。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dumb</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value:<span class="built_in">Int</span> = <span class="number">5</span></span><br><span class="line">    <span class="keyword">var</span> name:String = <span class="string">&quot;someone&quot;</span></span><br><span class="line">    <span class="keyword">constructor</span>(value:<span class="built_in">Int</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">constructor</span>(name:String)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> dumb1 = Dumb(<span class="number">132</span>)</span><br><span class="line">    <span class="keyword">val</span> dumb2 = Dumb(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;dumb1.value: <span class="subst">$&#123;dumb1.value&#125;</span> dumb1.name: <span class="subst">$&#123;dumb1.name&#125;</span>&quot;</span>)</span><br><span class="line">    println(<span class="string">&quot;dumb2.value: <span class="subst">$&#123;dumb2.value&#125;</span> dumb2.name: <span class="subst">$&#123;dumb2.name&#125;</span>&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Output:</span></span><br><span class="line"><span class="comment">dumb1.value: 132 dumb1.name: someone</span></span><br><span class="line"><span class="comment">dumb2.value: 5 dumb2.name: hello</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>


<h4 id="Constructor继承"><a href="#Constructor继承" class="headerlink" title="Constructor继承"></a>Constructor继承</h4><p>不管是直接还是间接，每一个构造函数都必须调用基类的某一个构造函数。<br>其中主构造函数调用时使用基类的名称，而二级构造函数调用时使用关键字super。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Base</span></span>(p: <span class="built_in">Int</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Derived</span></span>(p: <span class="built_in">Int</span>) : Base(p)</span><br></pre></td></tr></table></figure>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyView</span> : <span class="type">View &#123;</span></span></span><br><span class="line">    <span class="keyword">constructor</span>(ctx: Context) : <span class="keyword">super</span>(ctx)</span><br><span class="line">    <span class="keyword">constructor</span>(ctx: Context, attrs: AttributeSet) : <span class="keyword">super</span>(ctx, attrs)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在继承的时候，子类在保证调用基类构造函数的基础上，同样可以定义自己的property，两者并不冲突。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">open</span> <span class="class"><span class="keyword">class</span> <span class="title">Dumb</span></span>(<span class="keyword">var</span> value:<span class="built_in">Int</span> = <span class="number">5</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> name:String = <span class="string">&quot;someone&quot;</span></span><br><span class="line">    <span class="keyword">constructor</span>(value:<span class="built_in">Int</span>, name:String):<span class="keyword">this</span>(value)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigDumb</span></span>(value:<span class="built_in">Int</span>, <span class="keyword">var</span> weight:<span class="built_in">Int</span> = <span class="number">100</span>):Dumb(value)&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">main</span><span class="params">(args: <span class="type">Array</span>&lt;<span class="type">String</span>&gt;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">val</span> bob = Student(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">val</span> dumb = BigDumb(<span class="number">5</span>)</span><br><span class="line">    println(<span class="string">&quot;dumb.value: <span class="subst">$&#123;dumb.value&#125;</span>  dumb.name: <span class="subst">$&#123;dumb.weight&#125;</span>&quot;</span>) <span class="comment">//dumb.value: 5  dumb.weight: 100</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>kotlin比较有意思的一点是使用了两级构造函数，其中主构造函数颇有一种将类变成函数的意味，主构造函数的参数位于整个类的最顶部，<br>是类的DNA，是类最核心的参数，这样可以确保类最关键的参数被传进来，这种设计更加科学合理，可以减少bug。</p>
<p>参考内容: <a target="_blank" rel="noopener" href="https://kotlinlang.org/docs">kotlinlang.org&#x2F;docs</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/08/10/c-sharp-%E8%AF%AD%E6%B3%95%E4%B9%8Bupcast-downcast/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/08/10/c-sharp-%E8%AF%AD%E6%B3%95%E4%B9%8Bupcast-downcast/" itemprop="url">C# 语法之upcast & downcast</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-08-10T11:07:39+08:00">
                2022-08-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C#</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="C-语法之upcast-amp-downcast"><a href="#C-语法之upcast-amp-downcast" class="headerlink" title="C# 语法之upcast &amp; downcast"></a>C# 语法之upcast &amp; downcast</h1><h3 id="Upcast"><a href="#Upcast" class="headerlink" title="Upcast"></a>Upcast</h3><p>想象一个应用场景，当我想要实现一个物品背包，每个物品槽都是一个Item类型，然而具体的物品都是Item的子类而非Item本身，<br>例如我们有两个class，从Item衍生而出:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">float</span> price;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Sword</span> : <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> atk;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">Shield</span> : <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> def;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个时候，可以直接将子类存放到基类变量中吗？<br>例如</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Sword sword = <span class="keyword">new</span> Sword();</span><br><span class="line">Item item = sword;</span><br></pre></td></tr></table></figure>
<p>答案是肯定的。这个操作就叫作<code>upcast</code>，因为class是向上兼容的，<br>item具有的属性，sword全都具有，因此可以顺理成章地将sword放到item中。<br>但我们还有一些疑问没有解决：<br>1.我们可以使用形如item.atk这样的访问吗？毕竟我们知道我们存储的内容实际上是Sword类型<br>2.这个item中存放的是sword本体吗？还是一个向上兼容后的新对象？<br>我们来实验一下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sword sword = <span class="keyword">new</span> Sword();</span><br><span class="line">sword.atk = <span class="number">1</span>;</span><br><span class="line">Item item = sword;</span><br><span class="line">Console.WriteLine(<span class="string">&quot;item.atk = &quot;</span> + item.atk);</span><br></pre></td></tr></table></figure>
<p><strong>编译失败</strong>。说明无法访问item.atk，合理，因为item的类型是Item，是一个更广泛的概念，万一它存储的不是Sword类型呢？<br>因此这里不能因为你心里知道它是Sword就任由你胡作非为，语法是很严格的，严格才能确保规范和安全嘛。<br>关于第二问，我们暂且无法得知，因为我们没法通过item对atk进行修改，也无法验证这个修改有没有反映到sword本体。<br>别急，看标题就知道，我们还有另一种相反的操作：<code>downcast</code>。</p>
<h3 id="Downcast"><a href="#Downcast" class="headerlink" title="Downcast"></a>Downcast</h3><p>顾名思义，<code>downcast</code>就是将一个父类对象存放到子类对象中。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sword sword2 = (Sword)item;</span><br></pre></td></tr></table></figure>
<p>我们新建一个对象sword2，将item强制转化为Sword类型(注意这里必须说清楚你要转化的类型，否则编译也会失败，这也很好理解，因为程序不知道你要转化成什么，万一是Sword的子类呢？也是有可能的哦)，成功了！<br>那我们就好奇了，sword2现在是谁呢？是sword本体呢，还是一个复制品呢？它的atk值是多少呢？</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Sword sword = <span class="keyword">new</span> Sword();</span><br><span class="line">sword.atk = <span class="number">1</span>;</span><br><span class="line">Item item = sword;</span><br><span class="line">Sword sword2 = (Sword)item;</span><br><span class="line">sword.atk = <span class="number">5</span>;</span><br><span class="line">Console.WriteLine(<span class="string">&quot;sword2.atk = &quot;</span> + sword2.atk); <span class="comment">// Output: sword2.atk = 5</span></span><br><span class="line">sword2.atk = <span class="number">10</span>;</span><br><span class="line">Console.WriteLine(<span class="string">&quot;sword.atk = &quot;</span> + sword.atk); <span class="comment">// Output : sword.atk = 10</span></span><br></pre></td></tr></table></figure>
<p>通过上面这个实验，真相已经很显然了，sword2就是sword，虽然经过了item这个中间容器，但sword还是无损地传到了sword2中。<br>综合上面的种种现象，我得出结论：</p>
<blockquote>
<p><code>upcast</code>将子类对象存放到父类对象时，并不是将子类对象进行简化，而是存放了一个子类本体引用，暂时对外隐藏了父类中不存在的内容。</p>
</blockquote>
<p>例如这个例子中，item还是指代sword，只不过暂时无法通过item来访问sword.atk。</p>
<p>不过我们对于<code>downcast</code>似乎还有不太了解的地方。可以将父类转化为子类？怎么听都很扯啊，毕竟子类有父类中不存在的内容，难道c#可以无中生有吗？<br>但上面的downcast之所以可以成功，一个重要因素在于sword2的类型和item中对象的类型是一致的，都是Sword。<br>我们来试试<code>downcast</code>到另一个不同的子类：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Sword sword = <span class="keyword">new</span> Sword();</span><br><span class="line">sword.atk = <span class="number">1</span>;</span><br><span class="line">Item item = sword;</span><br><span class="line">Shield shield = (Shield) item; <span class="comment">// System.InvalidCastException!!</span></span><br></pre></td></tr></table></figure>
<p>结果出现了异常。这说明<code>downcast</code>也不是什么魔法。如果父类中存放的对象类型和<code>downcast</code>目标类型不兼容，也是会有问题的。<br>而这种问题编译时是无法发现的，只有运行时才会检验出来咯。</p>
<p>知道了这些，我们就可以放心地使用<code>upcast</code>和<code>downcast</code>来写背包功能啦！当然再比如可插拔式的敌人AI（就像芯片那样）也可以用同样的方法！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/11/Unity%E4%B9%8B%E8%8E%AB%E5%90%8D%E5%85%B6%E5%A6%99%E7%9A%84nullReferenceException/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/07/11/Unity%E4%B9%8B%E8%8E%AB%E5%90%8D%E5%85%B6%E5%A6%99%E7%9A%84nullReferenceException/" itemprop="url">Unity之莫名其妙的nullReferenceException</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-11T20:16:51+08:00">
                2022-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index">
                    <span itemprop="name">unity</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/tip/" itemprop="url" rel="index">
                    <span itemprop="name">tip</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;WaveJoint&gt; joints;</span><br><span class="line">...</span><br><span class="line">WaveJoint newJoint = newJointObj.GetComponent&lt;WaveJoint&gt;();</span><br><span class="line">joints.Add(newJoint);            </span><br></pre></td></tr></table></figure>
<p>大概有这么三句相关的代码。<br>程序在第三句处发生了nullReferenceException.<br>我第一反应是newJoint是null，可能是GetComponent有什么问题。<br>可是半天都没发现有任何问题。<br>弄到最后原来是joints是null。</p>
<h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>原来我一直用c++，c++可以不用new就实例化一个对象，殊不知c#不行。<br>和c++可以显式地使用对象指针不同，c#等面向对象语言都是默认使用对象指针，只不过看起来没有指针符号。<br>因此c++可以不用new就创建一个类的实例（这个实例占用的是栈的内存），<br>而c#就不行了，joints会默认是一个空指针，只能通过new来申请空间并且将指针保存到joints中。<br>所以改成下面的写法就没问题了：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">List&lt;WaveJoint&gt; joints = <span class="keyword">new</span> List&lt;WaveJoint&gt;();</span><br><span class="line">...</span><br><span class="line">WaveJoint newJoint = newJointObj.GetComponent&lt;WaveJoint&gt;();</span><br><span class="line">joints.Add(newJoint);            </span><br></pre></td></tr></table></figure>
<p>麻了。几个小时绕圈子。不过这下一辈子忘不掉了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/11/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-anchor-pivot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/07/11/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-anchor-pivot/" itemprop="url">unity基础概念:anchor & pivot</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-11T10:25:54+08:00">
                2022-07-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index">
                    <span itemprop="name">unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>UI类的对象都有几个属性，position，anchor，pivot，这些分别是干什么的呢？</p>
<h2 id="pivot"><a href="#pivot" class="headerlink" title="pivot"></a>pivot</h2><p>首先pivot比较容易理解。也就是旋转中心。图中的圆圈标出了pivot的位置。<br><img src="/2022/07/11/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-anchor-pivot/pivot0.png" alt="pivot"><br><code>pivot(rx,ry)</code>意思是旋转中心位于边框的<code>(sizeX*rx,sizeY*ry)</code>处。<br><code>pivot(0.5,0.5)</code>，意思是旋转中心位于边框的正中心。<br><img src="/2022/07/11/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-anchor-pivot/pivot.png" alt="tool handle position"><br>注意将tool handle position切换为pivot模式，否则代表pivot的圆圈无法拖动，也不会跟随数值而改变显示的位置。</p>
<h2 id="anchor"><a href="#anchor" class="headerlink" title="anchor"></a>anchor</h2><p>anchor是锚点的意思，也就是基准线。minX,maxX,minY,maxY分别表示了左右下上四条基准线的位置（和pivot一样同样是比例值）<br>不管canvas如何缩放，anchor的四条基准线位置始终和canvas成固定比例。<br><img src="/2022/07/11/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-anchor-pivot/anchor.png" alt="anchor"></p>
<h2 id="position"><a href="#position" class="headerlink" title="position"></a>position</h2><p>position描述的是UI的真实边框相对于基准线的偏移量。<br>例如top&#x3D;20，就代表UI上边界距离基准线20单位。<br><img src="/2022/07/11/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-anchor-pivot/position.png" alt="position-1"><br>注意这里的距离都是以向内部为正方向。也就是说，正的偏移量代表朝内偏移，负的代表朝外偏移。<br><img src="/2022/07/11/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-anchor-pivot/position2.png" alt="position-2"><br>特殊情况：当anchor四个顶点有重合，即变成一个点或者一条线的时候，压扁的那个维度就不再用两个偏移量表示，而是用pos表示位置，宽度或者高度来表示两条边的位置。这个也大同小异。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/10/unity%E8%A7%A3%E6%83%91%E7%B3%BB%E5%88%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/07/10/unity%E8%A7%A3%E6%83%91%E7%B3%BB%E5%88%97/" itemprop="url">unity解惑系列</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-10T21:34:10+08:00">
                2022-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index">
                    <span itemprop="name">unity</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/tips/" itemprop="url" rel="index">
                    <span itemprop="name">tips</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="gameObject-getComponent-vs-getComponent"><a href="#gameObject-getComponent-vs-getComponent" class="headerlink" title="gameObject.getComponent vs getComponent"></a>gameObject.getComponent vs getComponent</h2><p>我一直以为gameObject.getComponent是类的一个静态方法。<br>实际上是script类继承的monoBehavior里面的一个property叫gameObject，表示脚本依附的游戏对象。<br>这样就很清晰了。<br>前者是调用了gameObject的getComponent方法，而后者是调用了monoBehavior的getComponent的方法。<br>二者殊途同归。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/10/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-transform/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/07/10/unity%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5-transform/" itemprop="url">unity基础概念:transform</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-10T21:29:07+08:00">
                2022-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index">
                    <span itemprop="name">unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>transform并不是只能用来表示坐标、大小、旋转等基本信息。<br>实际上transform的一个重要功能在于维持hierarchy。也就是结构树。<br>我觉得这是unity很反直觉的一个地方，这一点不如godot那么直观（godot中每个node在结构树中的位置就代表了它的位置，所见即所得）。<br>我一直以为有什么办法直接表示gameObject的结构树，然而unity似乎只有transform相关的结构树。<br>目前我知道的是，这个结构树似乎足够使用了（子节点继承继承父节点的transform属性，以及移动、删除）。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/10/unity%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5-script/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Bubble">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/beer.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Bubble's bubble">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2022/07/10/unity%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5-script/" itemprop="url">unity基础概念:script</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2022-07-10T20:16:16+08:00">
                2022-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/unity/" itemprop="url" rel="index">
                    <span itemprop="name">unity</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>script是unity中的一个基本概念，即脚本，也就是写代码的地方，似乎没什么好说的。<br>但是有一些概念我还是困惑了好一阵子，所以在这边小结一下。</p>
<h2 id="script也是component"><a href="#script也是component" class="headerlink" title="script也是component"></a>script也是component</h2><p>首先，script并没有什么特别，它和其它component一样，是依附在gameObject上的一部分。<br>script每一帧被调用实际上和其它component每一帧被计算是一个道理。</p>
<h2 id="script本质是实例化的实现了特定接口的class"><a href="#script本质是实例化的实现了特定接口的class" class="headerlink" title="script本质是实例化的实现了特定接口的class"></a>script本质是实例化的实现了特定接口的class</h2><p>虽说script也是component，但它和其它component还是有些不同。<br><img src="/2022/07/10/unity%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5-script/picture1.png" alt="figure 1"><br>图中可以看到，其它component直接给出了类型名称，而script却是先给出类名称，然后括号里才是script。<br>我是这么理解的：一个脚本的本质是一个实例化的类，而不是一个笼统的脚本类。<br>关于实例化，这是面向对象里面的常识，我们都知道一个script在代码的class块中只是给出了定义，只有在代码中显式地进行实例化才会作为一个实体。但是在面对script的时候我却先入为主地忽略了这个机制，因为script通常依附在gameObject上，被引擎隐式地自动实例化了。而实际上，依附在gameObject上的脚本也是一个实例，它的本质实际上不是脚本类，而是对应的实例化的类。<br>一旦有了这一点认识，下面的代码也就不难理解：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Player player1 = GetComponent&lt;Player&gt;(); <span class="comment">//  并不是GetComponent&lt;script&gt;()</span></span><br><span class="line">player1.attack(); <span class="comment">// 和调用一个实例化对象的形式完全一致</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="并不是只有monobehavior"><a href="#并不是只有monobehavior" class="headerlink" title="并不是只有monobehavior"></a>并不是只有monobehavior</h2><p>上面提到，script也不过是一类特殊的实例化后的class，因此更一般的class实际上并不需要符合script的所有特点。<br>一般的class并不继承monobehavior。自然也不需要实现start、update等等method。<br>因此如果想要写一个纯数据结构，那用一般的class就行了。</p>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>有了上面这些认识，我觉得我可以清楚地意识到我写的代码究竟保存在什么地方，究竟作为什么对象，在什么环节起了作用。<br>这样我也可以更合理准确地安排我的代码结构。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">&lt;i class&#x3D;&quot;fa fa-angle-right&quot;&gt;&lt;&#x2F;i&gt;</a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/beer.png"
                alt="Bubble" />
            
              <p class="site-author-name" itemprop="name">Bubble</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">11</span>
                  <span class="site-state-item-name">categories</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">tags</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/Bubble-gzz" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://bubble327670@gmail.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                My Friends
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://leoleoasd.me/" title="Leo" target="_blank">Leo</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.bearxiong.xyz/" title="Littlebear" target="_blank">Littlebear</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Bubble</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
